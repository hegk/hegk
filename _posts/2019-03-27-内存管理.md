---
layout: post
title: 内存管理
date: 2019-03-27 12:00:00.000000001 +08:00
---	

### 一、理解内存管理和引用计数之间的区别

当去百度百科里查看内存管理词条的时候，第一句话就是：“内存管理是指软件运行时对计算机内存资源的分配和使用的技术。其最主要的目的是如何高效，快速的分配，并且在适当的时候释放和回收内存资源。”。当提到内存管理的时候，以引用计数为为内存管理技术的MRC、ARC都是一种内存管理的手段。所以要理解其中的差异，去体会之。

#### 内存布局

![内存布局](https://github.com/Fe7s/Fe7s.github.io/blob/master/assets/iamgesList/OCDevelopmentLanguage/02内存布局.png?raw=true)

iOS内存管理管理是对堆上的数据（OC对象）进行管理，栈上的数据（基础数据类型）由计算机自行管理

事例

```
int a = 1;
NSObject *object = [[NSObject alloc]init];
```
![对象的内存非配](https://github.com/Fe7s/Fe7s.github.io/blob/master/assets/iamgesList/OCDevelopmentLanguage/03对象的内存非配.png?raw=true)


### 二、怎么理解引用计数
![](http://hiphotos.baidu.com/feed/pic/item/48540923dd54564e40511483bfde9c82d1584f50.jpg)
(图片来自网络，侵权删)

当世间最后一个记得你的人也离去之时就是你真正在世间死去的时候 ---《COCO》

感受到了吗？对象，在某个生命周期里只要还有人记得你，那么在这段生命周期中你就没有被销毁，你就是随着存在的人的记忆永恒的。

|某个生命周期中的对象|是否真正死去|
|:---- |:----|
|对象出生|生成对象|
|对象在A的记忆中|A的记忆持有对象|
|A遗忘了对象|A的记忆释放了对象|
|对象死亡|对象在当前生命周期中被遗忘（销毁）|

内存管理的方式是使用OC方法来管理的，那看一下各种情况下所对应的方法：

|对象操作| OC对应的方法|引用计数变化|		
|:---- |:----|:----|
|对象出生并被自己持有|alloc、new、copy、mutableCopy和以这几个词开头的以驼峰法则命名的方法| +1 |
|对象被A的记忆持有|retain| +1 |
|对象被A遗忘释放|release| -1 |
|对象死亡|dealloc| -- |

内存管理方案的几个守则：

>* 自己生成的对象，自己所持有
>* 非自己生成的对象，自己也能持有（别人生成的对象，自己也能持有）
>* 不再需要自己持有的对象时，释放对象
>* 非自己持有的对象，自己无法去释放

简析一下OC内存管理所用的几个方法：		
alloc和new都能生成并持有一个对象；copy和mutableCopy分别基于NSCopying和NSMutableCopying生成并持有对象的副本（COPY对象）；		
持有用retain，释放用release，但是要知道一点：已经释放了对象，就别去访问了，对象在堆中的内存被销毁，当然在栈中由系统自行管理的对象的指针不确定。










